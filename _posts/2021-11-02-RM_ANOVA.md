---
title: 반복측정 분산분석(Repeated Measures ANOVA)
sidebar:
  nav: docs-ko
aside:
  toc: true
key: 20211102
tags: 통계학
---

이 포스팅은 Primer of Biostatistics, S. Glantz, 7판을 참고하여 작성하였습니다.

# Prerequisites

이 포스팅의 내용을 잘 이해하기 위해선 아래의 내용에 대해 알고 오시는 것을 추천합니다.

* [표본과 표준 오차의 의미](https://angeloyeo.github.io/2020/02/12/standard_error.html)
* [F-value의 의미와 분산분석](https://angeloyeo.github.io/2020/02/29/ANOVA.html)
* [대응 표본 t-검정](https://angeloyeo.github.io/2021/10/29/paired_t_test.html)

# Motivation

대응 표본 t-검정에서는 피험자들의 before / after 차이를 확인할 수 있었다. 그런데, 어떤 경우에는 애프터 이후의... 삼프터, 사프터(??)도 한번에 비교하고 싶을 때도 있지 않을까?

좋은 예시 중 하나로 의학적 처치 후의 팔로우-업(follow-up)이 있다.

팔로우-업은 처치의 before / after를 확인 후 일정 기간이 지난 뒤에 한번 더(가령 1년 후) 검진을 수행해 경과를 관찰하는 것을 말한다.

즉, 팔로우 업을 한번만 수행한다면 동일 피험자에 대해 세 번의 시간에 걸쳐 측정이 진행되는 것과 마찬가지다[^1].

[^1]: 추후에 더 서술하겠지만 반복 측정이 꼭 시간에 한정되는 개념은 아니다. 시간적이거나 공간적인 차원에서 모두 반복 측정이 가능하다.

이것을 분석하기 위한 통계적 기법이 바로 반복측정 분산분석(Repeated Measures ANOVA)이며 줄여서 RM ANOVA라고도 많이 부른다.

# 제곱합(Sum of Squares; SS)

모든 것은 제곱 합의 관점에서 재해석 해볼 수 있다.

## 용어 정리

$SS_{something}$이라고 쓰면 something에 의해서 설명되는 변동이다. 

평균 제곱(mean square; MS)은 SS의 평균으로써, 산술적 평균이 아니라 SS를 자유도로 나눈 값이다.

# ANOVA를 SS의 관점에서 이해해보기

# RM ANOVA

## RM ANOVA에 사용되는 데이터 구조

우선은 

<p align = "center">
  <img width = "600" src = "https://raw.githubusercontent.com/angeloyeo/angeloyeo.github.io/master/pics/2021-11-02-RM_ANOVA/pic1.png">
  <br>
  그림 1. 반복측정 데이터를 표와 기호로 정리한 것
</p>

## Sum of Squares 의 분할(증명)

$$SS_{tot} = \sum_{t}\sum_{s}(X_{ts}-\bar{X})^2$$

Let 

$$a_{ts} = X_{ts} - \bar{S_s}$$

where 

$$\bar{S_s} = \frac{1}{m}\sum_{t}X_{ts}$$

and

$$b_s = \bar{S_s}-\bar{X}$$

then,

$$X_{ts}-\bar{X} = X_{ts}-\bar{S_s} + \bar{S_s} - \bar{X}$$

$$=a_{ts}+b_s$$

We can figure out that...

$$\sum_{t}a_{ts}=\sum_t\left(X_{ts}-\bar{S_s}\right)$$

$$=\left(\sum_{t}X_{ts}\right)-m\bar{S_s}$$

$$=\sum_{t}X_{ts}-m\cdot\frac{1}{m}\sum_{t}X_{ts} = 0$$

Hence,

$$SS_{tot}=\sum_{t}\sum_{s}(X_{ts}-\bar{X})^2$$

$$=\sum_{t}\sum_{s}\left(a_{ts}+b_s\right)^2$$

$$=\sum_{t}\sum_{s}\left(a_{ts}^2+b_s^2+2a_{ts}b_s\right)$$

$$=\sum_{t}\sum_{s}\left(a_{ts}^2\right)+\sum_{t}\sum_{s}\left(b_s^2\right)+2\sum_{s}\left(b_s\left(\sum_{t}a_{ts}\right)\right)$$

식 ()~()에서 본 것 처럼 $\sum_t a_{ts}=0$과 같다. 따라서,

$$\Rightarrow \sum_{t}\sum_{s}\left(a_{ts}^2\right)+\sum_{t}\sum_{s}\left(b_s^2\right)+2\sum_{s}\left(b_s\left(0\right)\right)$$

$$=\sum_{t}\sum_{s}\left(a_{ts}^2\right)+\sum_{t}\sum_{s}\left(b_s^2\right)$$

$a_{ts}$와 $b_{s}$의 정의를 이용해 식을 다시 써주면,

$$\Rightarrow \sum_{t}\sum_{s}\left(X_{ts}-\bar{S}_s\right)^2+\sum_{t}\sum_{s}\left(\bar{S}_s-\bar{X}\right)^2$$

와 같다. 이 식에서 좌측에 있는 값이 $SS_{wit\cdot subj}$이고 우측에 있는 값이 $SS_{bet\cdot subj}$가 된다.

# 구형성

## Mauchly's test

## Epsilon 보정

Greenhouse-Geisser

Huyhn-Feldt

# 실습

MATLAB은 RM ANOVA 사용이 어렵다.

SAS, SPSS는 너무 비싸다.

R을 배울 시간은 또 없다면, Jamovi를 다운받아보자.

## Jamovi

# 참고문헌

* Primer of biostatistics, 7th ed., S. Glantz / Ch. 9 Experiments when each subject receives more than one treatment
* Statistical principles in experimental Design, 1st ed., B. J. Winer / Ch. 4 Single-factor experiments having repeated measures on the same elements